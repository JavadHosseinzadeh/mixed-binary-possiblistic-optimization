%% Save scenario results into Res cell array
Res{1,1}  = value(gen);        % Generator outputs
Res{1,2}  = value(ld);         % Load distribution
Res{1,3}  = value(ch);         % Charging power
Res{1,4}  = value(dch);        % Discharging power
Res{1,5}  = value(e__st);      % Storage energy levels
Res{1,6}  = value(k__in);      % Some control input
Res{1,7}  = value(u);          % Control variable u
Res{1,8}  = value(v);          % Control variable v
Res{1,9}  = value(Objective);  % Objective value
Res{1,10} = D_matrix;          % Demand matrix
Res{1,11} = mpc;               % MPC-related info
Res{1,12} = value(k__in/8);    % Scaled input
Res{1,13} = value(H_csp);      % CSP thermal storage level
Res{1,14} = value(gen_csp);    % CSP generation
Res{1,15} = scenario_time;     % Time in seconds for this scenario

%% Save to .mat file
name_folder = strcat(file_name, '.mat');
save(name_folder, 'Res');

%% Optional: Organize for structured access (recommended but optional)
% result_struct = struct( ...
%     'gen', value(gen), ...
%     'ld', value(ld), ...
%     'ch', value(ch), ...
%     'dch', value(dch), ...
%     'storage_energy', value(e__st), ...
%     'k_in', value(k__in), ...
%     'u', value(u), ...
%     'v', value(v), ...
%     'objective', value(Objective), ...
%     'demand_matrix', D_matrix, ...
%     'mpc_data', mpc, ...
%     'k_in_scaled', value(k__in/8), ...
%     'H_csp', value(H_csp), ...
%     'gen_csp', value(gen_csp), ...
%     'scenario_time', scenario_time ...
% );
% save(name_folder, 'result_struct');

